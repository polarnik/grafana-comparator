---
marp: true
title: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
description: –ü—Ä–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Grafana –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
theme: tdconf
template: bespoke
paginate: true
_paginate: false

---

<!-- _class: lead
-->

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

## –°–º–∏—Ä–Ω–æ–≤ –í—è—á–µ—Å–ª–∞–≤

### ![h:55](themes/img/lead/miro.svg) Miro 

<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->


---
<!-- _class: title -->

# –ò–Ω–∂–µ–Ω–µ—Ä ![h:55](themes/img/lead/miro.svg) Miro
## –†–∞–∑–≤–∏–≤–∞—é ![h:55](themes/img/lead/Telegram_logo.svg) qa_load

![bg cover](img/omsk.jpg)

<!-- 
–ü–æ–≤—ã—à–∞—é –∫–∞—á–µ—Å—Ç–≤–æ –±–æ–ª–µ–µ –¥–µ—Å—è—Ç–∏ –ª–µ—Ç. –ó–∞–Ω–∏–º–∞—é—Å—å —Å–∏—Å—Ç–µ–º–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü. –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å –º–æ–µ–π —Ä–∞–±–æ—Ç—ã ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –†–∞–∑–≤–∏–≤–∞—é —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ–º–æ–≥–∞—è –∫–æ–ª–ª–µ–≥–∞–º –≤ telegram —á–∞—Ç–µ ¬´QA ‚Äî Load & Performance¬ª.
-->

---
<!-- _class: main -->

# –ü—Ä–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ __Grafana__ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫

<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->


---
# –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ


# üìä __Start__/__Stop__-time –∏ –∏—Ö —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ

# üìä –ó–∞–ø–∏—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –æ–¥–Ω—É —Ç–æ—á–∫—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏

# üìä –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π __Grafana__ –∏–∑ —è—á–µ–π–∫–∏

# üìä –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–∂–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

# üìä –î–æ–±–∞–≤–ª–µ–Ω–∏–µ __tag__/__label__ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –æ—Ç–≤–µ—Ç

# üìä –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ __Grafana__

# üìä –°–º–µ—â–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –≤ __Grafana__



---

<!-- _class: main -->

# __TestId__/__RunId__/__*Id__ –∏–ª–∏ __Start__+__StopTime__ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---
# __4.__ üìä __Start__/__Stop__-time –∏ –∏—Ö —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ

- __Grafana__ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏–∑ __Prometheus__, __Victoria__, __InfluxDB__

- __Jenkins__ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è –º–æ–º–µ–Ω—Ç–æ–≤ —Å—Ç–∞—Ä—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞


---

# __Grafana__ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ __Prometheus__, __InfluxDB__, ...

![bg](img/compare.png)

---

# __Grafana__ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ __Prometheus__, __InfluxDB__, ...

```java
1. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ –ø–µ—Ä–≤–æ–º—É —Ç–µ—Å—Ç—É:
  - "Start" –∏ "Stop" - —Ñ–æ—Ä–º–∞—Ç unixTimeStamp, —Ç–∏–ø "tag"/"label"
2. –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Ç—Ä–æ–∫–µ –ø–µ—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ URL: 
  - from="Start", to="Stop", Start1="Start"
3. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ –≤—Ç–æ—Ä–æ–º—É —Ç–µ—Å—Ç—É
  - "Start" –∏ "Stop" - —Ñ–æ—Ä–º–∞—Ç unixTimeStamp, —Ç–∏–ø "tag"/"label"
  - "Start1" - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π "Start1"
  - "Offset" - –≤—ã—á–∏—Å–ª—è–µ–º–∞—è –∫–æ–ª–æ–Ω–∫–∞ "Start1"-"Start"
4. –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Ç—Ä–æ–∫–µ –≤—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ URL: 
  - "Offset"="Offset"
5. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–µ—Ä–≤–æ–º—É –∏ –≤—Ç–æ—Ä–æ–º—É —Ç–µ—Å—Ç–∞–º
  - –ø–æ –ø–µ—Ä–≤–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Ç "from" –¥–æ "to"
  - –ø–æ –≤—Ç–æ—Ä–æ–º—É —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º "Offset"
```

---

# –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ: __Start__ –∏ __Stop__, —Ç–∏–ø __tag__/__label__

```java
1. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ –ø–µ—Ä–≤–æ–º—É —Ç–µ—Å—Ç—É:
  - "Start" –∏ "Stop", —Ç–∏–ø "tag"/"label", —Ñ–æ—Ä–º–∞—Ç unixTimeStamp
2. –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Ç—Ä–æ–∫–µ –ø–µ—Ä–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ URL: 
  - from=Start, to=Stop, Start1=Start
3. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ –≤—Ç–æ—Ä–æ–º—É —Ç–µ—Å—Ç—É
  - "Start" –∏ "Stop", —Ç–∏–ø "tag"/"label", —Ñ–æ—Ä–º–∞—Ç unixTimeStamp
  - Start1 - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π Start1
  - Offset - –≤—ã—á–∏—Å–ª—è–µ–º–∞—è –∫–æ–ª–æ–Ω–∫–∞ Start1-Start
4. –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å—Ç—Ä–æ–∫–µ –≤—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ URL: 
  - Offset=Offset
5. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –ø–µ—Ä–≤–æ–º—É –∏ –≤—Ç–æ—Ä–æ–º—É —Ç–µ—Å—Ç–∞–º
  - –ø–æ –ø–µ—Ä–≤–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Ç from –¥–æ to
  - –ø–æ –≤—Ç–æ—Ä–æ–º—É —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º Offset
```

---

<!-- _class: main -->

# –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å __Start__/__Stop__-time –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞?
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---

# __Jenkins__ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è –º–æ–º–µ–Ω—Ç–æ–≤ —Å—Ç–∞—Ä—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## –î–æ —Ç–µ—Å—Ç–∞: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å __Start__ –∏ —Ä–∞—Å—á—ë—Ç–Ω—ã–π __Stop__-time
- –∫–∞–∫ __tag__/__label__

## –¢–µ—Å—Ç: ab, curl+bash, k6, jmeter, locust, gatling, junit, ...
- –ª—é–±–æ–π —Ç–µ—Å—Ç!

## –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å __Start__ –∏ __Stop__-time —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ
 - –∫–∞–∫ __tag__/__label__ 

---

# __Jenkins__ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è –º–æ–º–µ–Ω—Ç–æ–≤ —Å—Ç–∞—Ä—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## –î–æ —Ç–µ—Å—Ç–∞: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å __Start__ –∏ —Ä–∞—Å—á—ë—Ç–Ω—ã–π __Stop__-time
- –∫–∞–∫ __tag__/__label__ –≤ —Ñ–æ—Ä–º–∞—Ç–µ unixTimeStamp –¥–ª—è UTC

## –¢–µ—Å—Ç: ab, curl+bash, k6, jmeter, locust, gatling, junit, ...
- –ª—é–±–æ–π —Ç–µ—Å—Ç, –±–µ–∑ –º–µ—Ç—Ä–∏–∫, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π, ...

## –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å __Start__ –∏ __Stop__-time —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ
 - –∫–∞–∫ __tag__/__label__ –≤ —Ñ–æ—Ä–º–∞—Ç–µ unixTimeStamp –¥–ª—è UTC
 - +value __Duration__ –∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ
 - +tag/label –¥–ª—è __ServerVersion__, __Environment__, __PipelineName__, __Scenario__

---
# –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ __InfluxLine__ –≤ __VM__

```python
metricTime = 1640980800 # Fri Dec 31 2021 20:00:00 GMT+0000
reqBody = f'testStats,' \
        f'suite={row["suite"]},' \
        f'environment={row["env"]},' \
        f'version={row["version"]},' \
        f'start={row["startUnix"]},' \
        f'stop={row["stopUnix"]} ' \
        f'duration={row["duration"]} {metricTime}000000000'

http.post(
    url="http://victoriaMetrics:8428/write",
    data=reqBody
)
```


---
<!-- _class: main
-->

# –ó–∞–ø–∏—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –æ–¥–Ω—É —Ç–æ—á–∫—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---
# –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ __InfluxLine__ –≤ __VM__

```python
metricTime = 1640980800 # Fri Dec 31 2021 20:00:00 GMT+0000
```

# –ü—Ä–∏–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤ __VM__
```
(testStats_duration{suite=~"${suite}"} > 100) @1640980800
```

---
<!-- _class: main
-->

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π __Grafana__ –∏–∑ —è—á–µ–π–∫–∏
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π __Grafana__ –∏–∑ —è—á–µ–π–∫–∏

```
var-test2_time=${__data.fields.startUnix}
```

---
<!-- _class: main
-->

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–∂–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π


<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–∂–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

```
/d/${__dashboard}/?${source:queryparam}&${suite:queryparam}
```

---
<!-- _class: main
-->

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---
# –ü—Ä–∏–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ __VM__
## c –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

```java
label_replace(
    (testStats_duration{suite=~"${suite}"} > 100) @1640980800,
    "test1_time",
    "${test1_time}",
    "start_datetime", 
    ".*"
)
```

---
# –ü—Ä–∏–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ __InfluxDB__
## c –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

```sql
select 
    last(max)-last(max)+${test1_time} as "test1_time",
    last(duration)
from
    testStats_duration
where sute=~"${suite:regex}" and $timeFilter
group by
    "version", "environment"
```

---
<!-- _class: main
-->

# –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ __Grafana__
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---
<!-- _class: main
-->

# –°–º–µ—â–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –≤ __Grafana__
<!--
_footer: Image by Vlad Gerasimov on <a href="https://vlad.studio/">vlad.studio</a>
 -->
---

# –°–º–µ—â–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –≤ __Grafana__
# __offset__ –¥–ª—è __PromQL__

```
sum  (
  rate(
      redis_commands_total{
      }[$__rate_interval] offset ${offset}s
    )
)
```

---

# –°–º–µ—â–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –≤ __Grafana__
# __offset__ –¥–ª—è __InfluxQL__

```sql
select 
    max(total)
from "redis_commands"
where 
    time > ${offset} + ${__from} and 
    time < ${offset} + ${__to}
```

